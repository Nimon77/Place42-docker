# Internals

> Describing how most of it works

## Firefox

Everything starts with Firefox. I'm using https://hub.docker.com/r/jlesage/firefox/ for this. This docker image contains Firefox, with some modifications to make configuring it very easy. It also contains a webserver which you use to login.

## Tampermonkey

The [userscript](https://github.com/PlaceNL/Userscript) needs tampermonkey, so that addon is placed in config/profile/extensions/firefox@tampermonkey.net.xpi.

## Custom extension

Because it's just firefox, the [Chief](https://github.com/PlaceNL/Chief/) server doesn't know that we are using this headless firefox, instead of just the auto userscript. That's why I wrote a very simple extension.

The source is in the extension-source folder. I've packaged it on my pc with signing keys of my Mozilla account, and placed the output directly in `config/profile/extensions/{f2fb1a03-10b2-4514-9b97-7be0646f3d19}.xpi`. The filename is from the ID generated by mozilla. You can find it by unpacking the xpi file, inside `.browser_specific_settings.gecko.id`.

You can make sure the file content matches by changing the extension to .zip, and unpacking it. outside of the META-INF folder which is added by mozilla, the contents should be the same.

## Firefox config

To make auto restarts and initial setup easier, I've made some configuration changes to Firefox. Those are visible in docker-compose.yml, in the `environment` part. Every line has a comment describing what it does.